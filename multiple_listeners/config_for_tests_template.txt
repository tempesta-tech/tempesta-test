######################################
# This file has been auto generated. #
######################################
backends = [

    {
        'id': 'nginx',
        'type': 'nginx',
        'port': '8000',
        'status_uri': 'http://${server_ip}:8000/nginx_status',
        'config': """
            pid ${pid};
            worker_processes  auto;
            events {
                worker_connections   1024;
                use epoll;
            }
            http {
                keepalive_timeout ${server_keepalive_timeout};
                keepalive_requests ${server_keepalive_requests};
                sendfile         on;
                tcp_nopush       on;
                tcp_nodelay      on;
                open_file_cache max=1000;
                open_file_cache_valid 30s;
                open_file_cache_min_uses 2;
                open_file_cache_errors off;
                error_log /dev/null emerg;
                access_log off;
                server {
                    listen        ${server_ip}:8000;
                    location / {
                        return 200;
                    }
                    location /nginx_status {
                        stub_status on;
                    }
                }
            }
        """,
    }

]

clients = [
{% for client in clients %}
    {% if client.proto == 'h2' %}
    {
        'id': '{{ client.id }}',
        'type': 'external',
        'binary': 'h2spec',
        'ssl': True,
        'cmd_args': '-tkh {{ client.addr }} -p {{ client.port }}',
    },

    {% else %}
    {
        'id': '{{ client.id }}',
        'type': 'external',
        'binary': 'curl',
        'ssl': {% if client.proto == 'https' %}{{ True }}{% else %}{{ False }}{% endif %},
        'cmd_args': '-Ikf http{% if client.proto == 'https' %}s{% endif %}://{{ client.addr }}:{{ client.port }}/ '
    },
    {% endif %}

{% endfor %}

]

tempesta = {
    'config': """
    {% for l in listen %}
    {{ l }}
    {% endfor %}

        srv_group default {
            server ${server_ip}:8000;
        }

        vhost tempesta-cat {
            proxy_pass default;
        }

        tls_match_any_server_name;
        tls_certificate ECDSA/tfw-root.crt;
        tls_certificate_key ECDSA/tfw-root.key;

        cache 0;
        cache_fulfill * *;
        block_action attack reply;

        http_chain {
            -> tempesta-cat;
        }

    """
}

######################################
# This file has been auto generated. #
######################################
